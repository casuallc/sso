# 单点登录

## 多个业务系统公用一个用户系统，人一个业务系统完成登录后，访问其他业务系统后不需要重复登录。

### 实现
* 服务器保存登陆信息。
* 浏览器cookie中存放token信息。

### 简要流程（未登录状况）
* 用户访问系统A，重定向到用户系统，url中携带返回地址。
* 用户系统校验和保存referer等信息，生成唯一标识，跳转到登录界面引导用户登录。
* 登录成功后，保存用户登录信息和上一步骤的各种信息到redis或者其他缓存中，同样要保存到cookie中，然后返回系统A。

#### cookie中的信息
* token：本次登录标识、用户标识，用AES加密
* token和用户系统的秘钥的md5，防止token被篡改

### 登录后
* 系统A收到请求后，获取cookie中的信息然后校验token，解析出用户id，把token和分发给自己的秘钥生成MD5，通过http或者webservice向用户系统请求用户信息。
* 用户系统校验token，查询缓存获取用户信息后返会结果。
* 其他业务系统同样通过cookie获取用户信息。

### 关于cookie的共享
* 如果用户系统是顶级域名，业务系统位于顶级域名之下或者同级，之后就可以通过设置domain和path实现共享。
* 另外可以发送一次对用户系统的请求，用户系统获取所有cookie后返回给业务系统。

